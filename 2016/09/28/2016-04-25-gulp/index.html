<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="gulp," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="1、gulp的安装首先确保你已经正确安装了nodejs环境。然后以全局方式安装gulp： npm install -g gulp 全局安装gulp后，还需要在每个要使用gulp的项目中都单独安装一次。把目录切换到你的项目文件夹中，然后在命令行中执行： npm install gulp 如果想在安装的时候把gulp写进项目package.json文件的依赖中，则可以加上–save-dev： npm">
<meta name="keywords" content="gulp">
<meta property="og:type" content="article">
<meta property="og:title" content="gulp的一些总结">
<meta property="og:url" content="http://flyingliu.github.io/2016/09/28/2016-04-25-gulp/index.html">
<meta property="og:site_name" content="如是我闻">
<meta property="og:description" content="1、gulp的安装首先确保你已经正确安装了nodejs环境。然后以全局方式安装gulp： npm install -g gulp 全局安装gulp后，还需要在每个要使用gulp的项目中都单独安装一次。把目录切换到你的项目文件夹中，然后在命令行中执行： npm install gulp 如果想在安装的时候把gulp写进项目package.json文件的依赖中，则可以加上–save-dev： npm">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2017-08-29T00:15:15.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="gulp的一些总结">
<meta name="twitter:description" content="1、gulp的安装首先确保你已经正确安装了nodejs环境。然后以全局方式安装gulp： npm install -g gulp 全局安装gulp后，还需要在每个要使用gulp的项目中都单独安装一次。把目录切换到你的项目文件夹中，然后在命令行中执行： npm install gulp 如果想在安装的时候把gulp写进项目package.json文件的依赖中，则可以加上–save-dev： npm">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://flyingliu.github.io/2016/09/28/2016-04-25-gulp/"/>





  <title>gulp的一些总结 | 如是我闻</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">如是我闻</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">色即是空，空即是色</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://flyingliu.github.io/2016/09/28/2016-04-25-gulp/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="飞来小侠">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="如是我闻">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">gulp的一些总结</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-09-28T22:08:15+08:00">
                2016-09-28
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/09/28/2016-04-25-gulp/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/09/28/2016-04-25-gulp/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h5 id="1、gulp的安装"><a href="#1、gulp的安装" class="headerlink" title="1、gulp的安装"></a>1、gulp的安装</h5><p>首先确保你已经正确安装了nodejs环境。然后以全局方式安装gulp：</p>
<pre><code>npm install -g gulp
</code></pre><p>全局安装gulp后，还需要在每个要使用gulp的项目中都单独安装一次。把目录切换到你的项目文件夹中，然后在命令行中执行：</p>
<pre><code>npm install gulp
</code></pre><p>如果想在安装的时候把gulp写进项目package.json文件的依赖中，则可以加上–save-dev：</p>
<pre><code>npm install --save-dev gulp
</code></pre><p>这样就完成了gulp的安装。至于为什么在全局安装gulp后，还需要在项目中本地安装一次，有兴趣的可以看下stackoverflow上有人做出的回答：why-do-we-need-to-install-gulp-globally-and-locally、what-is-the-point-of-double-install-in-gulp。大体就是为了版本的灵活性，但如果没理解那也不必太去纠结这个问题，只需要知道通常我们是要这样做就行了。</p>
<h5 id="2、开始使用gulp"><a href="#2、开始使用gulp" class="headerlink" title="2、开始使用gulp"></a>2、开始使用gulp</h5><p>2.1 建立gulpfile.js文件</p>
<p>就像gruntjs需要一个Gruntfile.js文件一样，gulp也需要一个文件作为它的主文件，在gulp中这个文件叫做gulpfile.js。新建一个文件名为gulpfile.js的文件，然后放到你的项目目录中。之后要做的事情就是在gulpfile.js文件中定义我们的任务了。下面是一个最简单的gulpfile.js文件内容示例，它定义了一个默认的任务。</p>
<pre><code>var gulp = require(&apos;gulp&apos;);
gulp.task(&apos;default&apos;,function(){
    console.log(&apos;hello world&apos;);
});
</code></pre><p>此时我们的目录结构是这样子的：</p>
<pre><code>├── gulpfile.js
├── node_modules
│ └── gulp
└── package.json
</code></pre><p>2.2 运行gulp任务</p>
<p>要运行gulp任务，只需切换到存放gulpfile.js文件的目录(windows平台请使用cmd或者Power Shell等工具)，然后在命令行中执行gulp命令就行了，gulp后面可以加上要执行的任务名，例如gulp task1，如果没有指定任务名，则会执行任务名为default的默认任务。</p>
<h5 id="3、gulp的API介绍"><a href="#3、gulp的API介绍" class="headerlink" title="3、gulp的API介绍"></a>3、gulp的API介绍</h5><p>使用gulp，仅需知道4个API即可：gulp.task(),gulp.src(),gulp.dest(),gulp.watch()，所以很容易就能掌握，但有几个地方需理解透彻才行，我会在下面一一说明。为了避免出现理解偏差，建议先看一遍官方文档。</p>
<p>3.1 gulp.src()</p>
<p>在介绍这个API之前我们首先来说一下Grunt.js和Gulp.js工作方式的一个区别。Grunt主要是以文件为媒介来运行它的工作流的，比如在Grunt中执行完一项任务后，会把结果写入到一个临时文件中，然后可以在这个临时文件内容的基础上执行其它任务，执行完成后又把结果写入到临时文件中，然后又以这个为基础继续执行其它任务…就这样反复下去。而在Gulp中，使用的是Nodejs中的stream(流)，首先获取到需要的stream，然后可以通过stream的pipe()方法把流导入到你想要的地方，比如Gulp的插件中，经过插件处理后的流又可以继续导入到其他插件中，当然也可以把流写入到文件中。所以Gulp是以stream为媒介的，它不需要频繁的生成临时文件，这也是Gulp的速度比Grunt快的一个原因。再回到正题上来，gulp.src()方法正是用来获取流的，但要注意这个流里的内容不是原始的文件流，而是一个虚拟文件对象流(Vinyl files)，这个虚拟文件对象中存储着原始文件的路径、文件名、内容等信息，这个我们暂时不用去深入理解，你只需简单的理解可以用这个方法来读取你需要操作的文件就行了。其语法为：</p>
<pre><code>gulp.src(globs[, options])
</code></pre><p>globs参数是文件匹配模式(类似正则表达式)，用来匹配文件路径(包括文件名)，当然这里也可以直接指定某个具体的文件路径。当有多个匹配模式时，该参数可以为一个数组。<br>options为可选参数。通常情况下我们不需要用到。</p>
<p>下面我们重点说说Gulp用到的glob的匹配规则以及一些文件匹配技巧。<br>Gulp内部使用了node-glob模块来实现其文件匹配功能。我们可以使用下面这些特殊的字符来匹配我们想要的文件：</p>
<ul>
<li>匹配文件路径中的0个或多个字符，但不会匹配路径分隔符，除非路径分隔符出现在末尾</li>
</ul>
<p>** 匹配路径中的0个或多个目录及其子目录,需要单独出现，即它左右不能有其他东西了。如果出现在末尾，也能匹配文件。</p>
<p>? 匹配文件路径中的一个字符(不会匹配路径分隔符)</p>
<p>[…] 匹配方括号中出现的字符中的任意一个，当方括号中第一个字符为^或!时，则表示不匹配方括号中出现的其他字符中的任意一个，类似js正则表达式中的用法</p>
<pre><code>!(pattern|pattern|pattern) 匹配任何与括号中给定的任一模式都不匹配的

?(pattern|pattern|pattern) 匹配括号中给定的任一模式0次或1次，类似于js正则中的(pattern|pattern|pattern)?

+(pattern|pattern|pattern) 匹配括号中给定的任一模式至少1次，类似于js正则中的(pattern|pattern|pattern)+

*(pattern|pattern|pattern) 匹配括号中给定的任一模式0次或多次，类似于js正则中的(pattern|pattern|pattern)*

@(pattern|pattern|pattern) 匹配括号中给定的任一模式1次，类似于js正则中的(pattern|pattern|pattern)
</code></pre><p>下面以一系列例子来加深理解</p>
<blockquote>
<ul>
<li>能匹配 a.js,x.y,abc,abc/,但不能匹配a/b.js<br><em>.</em> 能匹配 a.js,style.css,a.b,x.y<br><em>/</em>/<em>.js 能匹配 a/b/c.js,x/y/z.js,不能匹配a/b.js,a/b/c/d.js<br><strong> 能匹配 abc,a/b.js,a/b/c.js,x/y/z,x/y/z/a.b,能用来匹配所有的目录和文件
</strong>/</em>.js 能匹配 foo.js,a/foo.js,a/b/foo.js,a/b/c/foo.js<br>a/<strong>/z 能匹配 a/z,a/b/z,a/b/c/z,a/d/g/h/j/k/z<br>a/</strong>b/z 能匹配 a/b/z,a/sb/z,但不能匹配a/x/sb/z,因为只有单**单独出现才能匹配多级目录<br>?.js 能匹配 a.js,b.js,c.js<br>a?? 能匹配 a.b,abc,但不能匹配ab/,因为它不会匹配路径分隔符<br>[xyz].js 只能匹配 x.js,y.js,z.js,不会匹配xy.js,xyz.js等,整个中括号只代表一个字符<br>[^xyz].js 能匹配 a.js,b.js,c.js等,不能匹配x.js,y.js,z.js<br>当有多种匹配模式时可以使用数组</li>
</ul>
</blockquote>
<p>//使用数组的方式来匹配多种文件</p>
<pre><code>gulp.src([&apos;js/*.js&apos;,&apos;css/*.css&apos;,&apos;*.html&apos;])
</code></pre><p>使用数组的方式还有一个好处就是可以很方便的使用排除模式，在数组中的单个匹配模式前加上!即是排除模式，它会在匹配的结果中排除这个匹配，要注意一点的是不能在数组中的第一个元素中使用排除模式</p>
<p>gulp.src([<em>.js,’!b</em>.js’]) //匹配所有js文件，但排除掉以b开头的js文件</p>
<p>gulp.src([‘!b<em>.js’,</em>.js]) //不会排除任何文件，因为排除模式不能出现在数组的第一个元素中</p>
<p>此外，还可以使用展开模式。展开模式以花括号作为定界符，根据它里面的内容，会展开为多个模式，最后匹配的结果为所有展开的模式相加起来得到的结果。展开的例子如下：</p>
<pre><code>a{b,c}d 会展开为 abd,acd
a{b,}c 会展开为 abc,ac
a{0..3}d 会展开为 a0d,a1d,a2d,a3d
a{b,c{d,e}f}g 会展开为 abg,acdfg,acefg
a{b,c}d{e,f}g 会展开为 abdeg,acdeg,abdeg,abdfg
</code></pre><p>3.2 gulp.dest()</p>
<p>gulp.dest()方法是用来写文件的，其语法为：</p>
<pre><code>gulp.dest(path[,options])
</code></pre><p>path为写入文件的路径</p>
<p>options为一个可选的参数对象，通常我们不需要用到</p>
<p>要想使用好gulp.dest()这个方法，就要理解给它传入的路径参数与最终生成的文件的关系。<br>gulp的使用流程一般是这样子的：首先通过gulp.src()方法获取到我们想要处理的文件流，然后把文件流通过pipe方法导入到gulp的插件中，最后把经过插件处理后的流再通过pipe方法导入到gulp.dest()中，gulp.dest()方法则把流中的内容写入到文件中，这里首先需要弄清楚的一点是，我们给gulp.dest()传入的路径参数，只能用来指定要生成的文件的目录，而不能指定生成文件的文件名，它生成文件的文件名使用的是导入到它的文件流自身的文件名，所以生成的文件名是由导入到它的文件流决定的，即使我们给它传入一个带有文件名的路径参数，然后它也会把这个文件名当做是目录名，例如：</p>
<pre><code>var gulp = require(&apos;gulp&apos;);
gulp.src(&apos;script/jquery.js&apos;)
    .pipe(gulp.dest(&apos;dist/foo.js&apos;));
//最终生成的文件路径为 dist/foo.js/jquery.js,而不是dist/foo.js
</code></pre><p>要想改变文件名，可以使用插件gulp-rename</p>
<p>下面说说生成的文件路径与我们给gulp.dest()方法传入的路径参数之间的关系。<br>gulp.dest(path)生成的文件路径是我们传入的path参数后面再加上gulp.src()中有通配符开始出现的那部分路径。例如：</p>
<pre><code>var gulp = reruire(&apos;gulp&apos;);

//有通配符开始出现的那部分路径为 **/*.js

gulp.src(&apos;script/**/*.js&apos;)
    .pipe(gulp.dest(&apos;dist&apos;)); //最后生成的文件路径为 dist/**/*.js
//如果 **/*.js 匹配到的文件为 jquery/jquery.js ,则生成的文件路径为 dist/jquery/jquery.js
</code></pre><p>再举更多一点的例子</p>
<pre><code>gulp.src(&apos;script/avalon/avalon.js&apos;) //没有通配符出现的情况
    .pipe(gulp.dest(&apos;dist&apos;)); //最后生成的文件路径为 dist/avalon.js
</code></pre><p>//有通配符开始出现的那部分路径为 **/underscore.js</p>
<pre><code>gulp.src(&apos;script/**/underscore.js&apos;)
    //假设匹配到的文件为script/util/underscore.js
    .pipe(gulp.dest(&apos;dist&apos;)); //则最后生成的文件路径为 dist/util/underscore.js

gulp.src(&apos;script/*&apos;) //有通配符出现的那部分路径为 *
    //假设匹配到的文件为script/zepto.js    
    .pipe(gulp.dest(&apos;dist&apos;)); //则最后生成的文件路径为 dist/zepto.js
</code></pre><p>通过指定gulp.src()方法配置参数中的base属性，我们可以更灵活的来改变gulp.dest()生成的文件路径。</p>
<p>当我们没有在gulp.src()方法中配置base属性时，base的默认值为通配符开始出现之前那部分路径，例如：</p>
<pre><code>gulp.src(&apos;app/src/**/*.css&apos;) //此时base的值为 app/src
</code></pre><p>上面我们说的gulp.dest()所生成的文件路径的规则，其实也可以理解成，用我们给gulp.dest()传入的路径替换掉gulp.src()中的base路径，最终得到生成文件的路径。</p>
<pre><code>gulp.src(&apos;app/src/**/*.css&apos;) //此时base的值为app/src,也就是说它的base路径为app/src
     //设该模式匹配到了文件 app/src/css/normal.css
    .pipe(gulp.dest(&apos;dist&apos;)) //用dist替换掉base路径，最终得到 dist/css/normal.css
</code></pre><p>所以改变base路径后，gulp.dest()生成的文件路径也会改变</p>
<pre><code>gulp.src(script/lib/*.js) //没有配置base参数，此时默认的base路径为script/lib
    //假设匹配到的文件为script/lib/jquery.js
    .pipe(gulp.dest(&apos;build&apos;)) //生成的文件路径为 build/jquery.js

gulp.src(script/lib/*.js, {base:&apos;script&apos;}) //配置了base参数，此时base路径为script
    //假设匹配到的文件为script/lib/jquery.js
    .pipe(gulp.dest(&apos;build&apos;)) //此时生成的文件路径为 build/lib/jquery.js 
</code></pre><p>用gulp.dest()把文件流写入文件后，文件流仍然可以继续使用。</p>
<p>3.3 gulp.task()</p>
<p>gulp.task方法用来定义任务，内部使用的是Orchestrator，其语法为：</p>
<p>gulp.task(name[, deps], fn)</p>
<p>name 为任务名<br>deps 是当前定义的任务需要依赖的其他任务，为一个数组。当前定义的任务会在所有依赖的任务执行完毕后才开始执行。如果没有依赖，则可省略这个参数<br>fn 为任务函数，我们把任务要执行的代码都写在里面。该参数也是可选的。</p>
<pre><code>gulp.task(&apos;mytask&apos;, [&apos;array&apos;, &apos;of&apos;, &apos;task&apos;, &apos;names&apos;], function() { //定义一个有依赖的任务
  // Do something
});
</code></pre><p>gulp.task()这个API没什么好讲的，但需要知道执行多个任务时怎么来控制任务执行的顺序。</p>
<p>gulp中执行多个任务，可以通过任务依赖来实现。例如我想要执行one,two,three这三个任务，那我们就可以定义一个空的任务，然后把那三个任务当做这个空的任务的依赖就行了：</p>
<p>//只要执行default任务，就相当于把one,two,three这三个任务执行了</p>
<pre><code>gulp.task(&apos;default&apos;,[&apos;one&apos;,&apos;two&apos;,&apos;three&apos;]);
</code></pre><p>如果任务相互之间没有依赖，任务会按你书写的顺序来执行，如果有依赖的话则会先执行依赖的任务。<br>但是如果某个任务所依赖的任务是异步的，就要注意了，gulp并不会等待那个所依赖的异步任务完成，而是会接着执行后续的任务。例如：</p>
<pre><code>gulp.task(&apos;one&apos;,function(){
  //one是一个异步执行的任务
  setTimeout(function(){
    console.log(&apos;one is done&apos;)
  },5000);
});
</code></pre><p>//two任务虽然依赖于one任务,但并不会等到one任务中的异步操作完成后再执行</p>
<pre><code>gulp.task(&apos;two&apos;,[&apos;one&apos;],function(){
  console.log(&apos;two is done&apos;);
});
</code></pre><p>上面的例子中我们执行two任务时，会先执行one任务，但不会去等待one任务中的异步作完成后再执行two任务，而是紧接着执行two任务。所以two任务会在one任务中的异步操作完成之前就执行了。</p>
<p>那如果我们想等待异步任务中的异步操作完成后再执行后续的任务，该怎么做呢？</p>
<p>有三种方法可以实现：</p>
<p>第一：在异步操作完成后执行一个回调函数来通知gulp这个异步任务已经完成,这个回调函数就是任务函数的第一个参数。</p>
<pre><code>gulp.task(&apos;one&apos;,function(cb){ //cb为任务函数提供的回调，用来通知任务已经完成
  //one是一个异步执行的任务
  setTimeout(function(){
    console.log(&apos;one is done&apos;);
    cb();  //执行回调，表示这个异步任务已经完成
  },5000);
});

//这时two任务会在one任务中的异步操作完成后再执行

gulp.task(&apos;two&apos;,[&apos;one&apos;],function(){
  console.log(&apos;two is done&apos;);
});
</code></pre><p>第二：定义任务时返回一个流对象。适用于任务就是操作gulp.src获取到的流的情况。</p>
<pre><code>gulp.task(&apos;one&apos;,function(cb){
  var stream = gulp.src(&apos;client/**/*.js&apos;)
      .pipe(dosomething()) //dosomething()中有某些异步操作
      .pipe(gulp.dest(&apos;build&apos;));
    return stream;
});

gulp.task(&apos;two&apos;,[&apos;one&apos;],function(){
  console.log(&apos;two is done&apos;);
});
</code></pre><p>第三：返回一个promise对象，例如</p>
<pre><code>var Q = require(&apos;q&apos;); //一个著名的异步处理的库 https://github.com/kriskowal/q
gulp.task(&apos;one&apos;,function(cb){
  var deferred = Q.defer();
  // 做一些异步操作
  setTimeout(function() {
     deferred.resolve();
  }, 5000);
  return deferred.promise;
});

gulp.task(&apos;two&apos;,[&apos;one&apos;],function(){
  console.log(&apos;two is done&apos;);
});
</code></pre><p>gulp.task()就这些了，主要是要知道当依赖是异步任务时的处理。</p>
<p>3.4 gulp.watch()</p>
<p>gulp.watch()用来监视文件的变化，当文件发生变化后，我们可以利用它来执行相应的任务，例如文件压缩等。其语法为</p>
<pre><code>gulp.watch(glob[, opts], tasks)
</code></pre><p>glob 为要监视的文件匹配模式，规则和用法与gulp.src()方法中的glob相同。</p>
<p>opts 为一个可选的配置对象，通常不需要用到</p>
<p>tasks 为文件变化后要执行的任务，为一个数组</p>
<pre><code>gulp.task(&apos;uglify&apos;,function(){
  //do something
});
gulp.task(&apos;reload&apos;,function(){
  //do something
});
gulp.watch(&apos;js/**/*.js&apos;, [&apos;uglify&apos;,&apos;reload&apos;]);
gulp.watch()还有另外一种使用方式：

gulp.watch(glob[, opts, cb])
</code></pre><p>glob和opts参数与第一种用法相同</p>
<p>cb参数为一个函数。每当监视的文件发生变化时，就会调用这个函数,并且会给它传入一个对象，该对象包含了文件变化的一些信息，type属性为变化的类型，可以是added,changed,deleted；path属性为发生变化的文件的路径</p>
<pre><code>gulp.watch(&apos;js/**/*.js&apos;, function(event){
    console.log(event.type); //变化类型 added为新增,deleted为删除，changed为改变 
    console.log(event.path); //变化的文件的路径
}); 
</code></pre><h5 id="4、一些常用的gulp插件"><a href="#4、一些常用的gulp插件" class="headerlink" title="4、一些常用的gulp插件"></a>4、一些常用的gulp插件</h5><p>gulp的插件数量虽然没有grunt那么多，但也可以说是应有尽有了，下面列举一些常用的插件。</p>
<p>4.1 自动加载插件</p>
<p>使用gulp-load-plugins<br>安装：npm install –save-dev gulp-load-plugins<br>要使用gulp的插件，首先得用require来把插件加载进来，如果我们要使用的插件非常多，那我们的gulpfile.js文件开头可能就会是这个样子的：</p>
<pre><code>var gulp = require(&apos;gulp&apos;),
    //一些gulp插件,abcd这些命名只是用来举个例子
    a = require(&apos;gulp-a&apos;), 
    b = require(&apos;gulp-b&apos;),
    c = require(&apos;gulp-c&apos;),
    d = require(&apos;gulp-d&apos;),
    e = require(&apos;gulp-e&apos;),
    f = require(&apos;gulp-f&apos;),
    g = require(&apos;gulp-g&apos;),
    //更多的插件...
    z = require(&apos;gulp-z&apos;);   
</code></pre><p>虽然这没什么问题，但会使我们的gulpfile.js文件变得很冗长，看上去不那么舒服。gulp-load-plugins插件正是用来解决这个问题。<br>gulp-load-plugins这个插件能自动帮你加载package.json文件里的gulp插件。例如假设你的package.json文件里的依赖是这样的:</p>
<pre><code>{
  &quot;devDependencies&quot;: {
    &quot;gulp&quot;: &quot;~3.6.0&quot;,
    &quot;gulp-rename&quot;: &quot;~1.2.0&quot;,
    &quot;gulp-ruby-sass&quot;: &quot;~0.4.3&quot;,
    &quot;gulp-load-plugins&quot;: &quot;~0.5.1&quot;
  }
}
</code></pre><p>然后我们可以在gulpfile.js中使用gulp-load-plugins来帮我们加载插件：</p>
<pre><code>var gulp = require(&apos;gulp&apos;);
</code></pre><p>//加载gulp-load-plugins插件，并马上运行它</p>
<pre><code>var plugins = require(&apos;gulp-load-plugins&apos;)();
</code></pre><p>然后我们要使用gulp-rename和gulp-ruby-sass这两个插件的时候，就可以使用plugins.rename和plugins.rubySass来代替了,也就是原始插件名去掉gulp-前缀，之后再转换为驼峰命名。</p>
<p>实质上gulp-load-plugins是为我们做了如下的转换</p>
<pre><code>plugins.rename = require(&apos;gulp-rename&apos;);
plugins.rubySass = require(&apos;gulp-ruby-sass&apos;);
</code></pre><p>gulp-load-plugins并不会一开始就加载所有package.json里的gulp插件，而是在我们需要用到某个插件的时候，才去加载那个插件。<br>最后要提醒的一点是，因为gulp-load-plugins是通过你的package.json文件来加载插件的，所以必须要保证你需要自动加载的插件已经写入到了package.json文件里，并且这些插件都是已经安装好了的。</p>
<p>4.2 重命名</p>
<p>使用gulp-rename<br>安装：npm install –save-dev gulp-rename<br>用来重命名文件流中的文件。用gulp.dest()方法写入文件时，文件名使用的是文件流中的文件名，如果要想改变文件名，那可以在之前用gulp-rename插件来改变文件流中的文件名。</p>
<pre><code>var gulp = require(&apos;gulp&apos;),
    rename = require(&apos;gulp-rename&apos;),
    uglify = require(&quot;gulp-uglify&quot;);

gulp.task(&apos;rename&apos;, function () {
    gulp.src(&apos;js/jquery.js&apos;)
    .pipe(uglify())  //压缩
    .pipe(rename(&apos;jquery.min.js&apos;)) //会将jquery.js重命名为jquery.min.js
    .pipe(gulp.dest(&apos;js&apos;));
    //关于gulp-rename的更多强大的用法请参考https://www.npmjs.com/package/gulp-rename
});
</code></pre><p>4.3 js文件压缩</p>
<p>使用gulp-uglify<br>安装：npm install –save-dev gulp-uglify<br>用来压缩js文件，使用的是uglify引擎</p>
<pre><code>var gulp = require(&apos;gulp&apos;),
    uglify = require(&quot;gulp-uglify&quot;);

gulp.task(&apos;minify-js&apos;, function () {
    gulp.src(&apos;js/*.js&apos;) // 要压缩的js文件
    .pipe(uglify())  //使用uglify进行压缩,更多配置请参考：
    .pipe(gulp.dest(&apos;dist/js&apos;)); //压缩后的路径
});
</code></pre><p>4.4 css文件压缩</p>
<p>使用gulp-minify-css<br>安装：npm install –save-dev gulp-minify-css<br>要压缩css文件时可以使用该插件</p>
<pre><code>var gulp = require(&apos;gulp&apos;),
    minifyCss = require(&quot;gulp-minify-css&quot;);

gulp.task(&apos;minify-css&apos;, function () {
    gulp.src(&apos;css/*.css&apos;) // 要压缩的css文件
    .pipe(minifyCss()) //压缩css
    .pipe(gulp.dest(&apos;dist/css&apos;));
});
</code></pre><p>4.5 html文件压缩</p>
<p>使用gulp-minify-html<br>安装：npm install –save-dev gulp-minify-html<br>用来压缩html文件</p>
<pre><code>var gulp = require(&apos;gulp&apos;),
    minifyHtml = require(&quot;gulp-minify-html&quot;);

gulp.task(&apos;minify-html&apos;, function () {
    gulp.src(&apos;html/*.html&apos;) // 要压缩的html文件
    .pipe(minifyHtml()) //压缩
    .pipe(gulp.dest(&apos;dist/html&apos;));
});
</code></pre><p>4.6 js代码检查</p>
<p>使用gulp-jshint<br>安装：npm install –save-dev gulp-jshint<br>用来检查js代码</p>
<pre><code>var gulp = require(&apos;gulp&apos;),
    jshint = require(&quot;gulp-jshint&quot;);

gulp.task(&apos;jsLint&apos;, function () {
    gulp.src(&apos;js/*.js&apos;)
    .pipe(jshint())
    .pipe(jshint.reporter()); // 输出检查结果
});
</code></pre><p>4.7 文件合并</p>
<p>使用gulp-concat<br>安装：npm install –save-dev gulp-concat<br>用来把多个文件合并为一个文件,我们可以用它来合并js或css文件等，这样就能减少页面的http请求数了</p>
<pre><code>var gulp = require(&apos;gulp&apos;),
    concat = require(&quot;gulp-concat&quot;);

gulp.task(&apos;concat&apos;, function () {
    gulp.src(&apos;js/*.js&apos;)  //要合并的文件
    .pipe(concat(&apos;all.js&apos;))  // 合并匹配到的js文件并命名为 &quot;all.js&quot;
    .pipe(gulp.dest(&apos;dist/js&apos;));
});
</code></pre><p>4.8 less和sass的编译</p>
<p>less使用gulp-less,安装：npm install –save-dev gulp-less</p>
<pre><code>var gulp = require(&apos;gulp&apos;),
    less = require(&quot;gulp-less&quot;);

gulp.task(&apos;compile-less&apos;, function () {
    gulp.src(&apos;less/*.less&apos;)
    .pipe(less())
    .pipe(gulp.dest(&apos;dist/css&apos;));
});
</code></pre><p>sass使用gulp-sass,安装：npm install –save-dev gulp-sass</p>
<pre><code>var gulp = require(&apos;gulp&apos;),
    sass = require(&quot;gulp-sass&quot;);

gulp.task(&apos;compile-sass&apos;, function () {
    gulp.src(&apos;sass/*.sass&apos;)
    .pipe(sass())
    .pipe(gulp.dest(&apos;dist/css&apos;));
});
</code></pre><p>4.9 图片压缩</p>
<p>可以使用gulp-imagemin插件来压缩jpg、png、gif等图片。<br>安装：npm install –save-dev gulp-imagemin</p>
<pre><code>var gulp = require(&apos;gulp&apos;);
var imagemin = require(&apos;gulp-imagemin&apos;);
var pngquant = require(&apos;imagemin-pngquant&apos;); //png图片压缩插件

gulp.task(&apos;default&apos;, function () {
    return gulp.src(&apos;src/images/*&apos;)
        .pipe(imagemin({
            progressive: true,
            use: [pngquant()] //使用pngquant来压缩png图片
        }))
        .pipe(gulp.dest(&apos;dist&apos;));
});
</code></pre><p>gulp-imagemin的使用比较复杂一点，而且它本身也有很多插件，建议去它的项目主页看看文档</p>
<p>4.10 自动刷新</p>
<p>使用gulp-livereload插件，安装:npm install –save-dev gulp-livereload。<br>当代码变化时，它可以帮我们自动刷新页面<br>该插件最好配合谷歌浏览器来使用，且要安装livereload chrome extension扩展插件,不能下载的请自行FQ。</p>
<pre><code>var gulp = require(&apos;gulp&apos;),
    less = require(&apos;gulp-less&apos;),
    livereload = require(&apos;gulp-livereload&apos;);

gulp.task(&apos;less&apos;, function() {
  gulp.src(&apos;less/*.less&apos;)
    .pipe(less())
    .pipe(gulp.dest(&apos;css&apos;))
    .pipe(livereload());
});

gulp.task(&apos;watch&apos;, function() {
  livereload.listen(); //要在这里调用listen()方法
  gulp.watch(&apos;less/*.less&apos;, [&apos;less&apos;]);
});
</code></pre><p>如对gulp还有什么不明白之处，或者本文有什么遗漏或错误，欢迎一起交流和探讨~</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/gulp/" rel="tag"># gulp</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/04/10/2016-04-10-js-extend/" rel="next" title="理解JS构造函数继承">
                <i class="fa fa-chevron-left"></i> 理解JS构造函数继承
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/09/28/2016-07-02-gulp-config/" rel="prev" title="gulp的配置文件">
                gulp的配置文件 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="飞来小侠" />
          <p class="site-author-name" itemprop="name">飞来小侠</p>
           
              <p class="site-description motion-element" itemprop="description">依法不依人，依义不依语。</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">58</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">19</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/flyingliu" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/u/5872146656" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                    
                      Weibo
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.douban.com/people/guolaiwan/" target="_blank" title="豆瓣">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                    
                      豆瓣
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/liu-fei-lai/activities" target="_blank" title="知乎">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                    
                      知乎
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-5"><a class="nav-link" href="#1、gulp的安装"><span class="nav-number">1.</span> <span class="nav-text">1、gulp的安装</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2、开始使用gulp"><span class="nav-number">2.</span> <span class="nav-text">2、开始使用gulp</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3、gulp的API介绍"><span class="nav-number">3.</span> <span class="nav-text">3、gulp的API介绍</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4、一些常用的gulp插件"><span class="nav-number">4.</span> <span class="nav-text">4、一些常用的gulp插件</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">飞来小侠</span>

  
</div>


  <div class="powered-by">
    由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
  </div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">
    主题 &mdash;
    <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
      NexT.Pisces
    </a>
  </div>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  

    
      <script id="dsq-count-scr" src="https://ananfo.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'http://flyingliu.github.io/2016/09/28/2016-04-25-gulp/';
          this.page.identifier = '2016/09/28/2016-04-25-gulp/';
          this.page.title = 'gulp的一些总结';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://ananfo.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  










  





  

  

  

  

  

  

</body>
</html>
