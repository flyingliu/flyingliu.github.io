<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="依法不依人，依义不依语。">
<meta property="og:type" content="website">
<meta property="og:title" content="如是我闻">
<meta property="og:url" content="http://flyingliu.github.io/page/6/index.html">
<meta property="og:site_name" content="如是我闻">
<meta property="og:description" content="依法不依人，依义不依语。">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="如是我闻">
<meta name="twitter:description" content="依法不依人，依义不依语。">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://flyingliu.github.io/page/6/"/>





  <title>如是我闻</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">如是我闻</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">色即是空，空即是色</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://flyingliu.github.io/2015/11/15/2015-10-10-bibao/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="飞来小侠">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="如是我闻">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/11/15/2015-10-10-bibao/" itemprop="url">闭包</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-11-15T16:37:02+08:00">
                2015-11-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/11/15/2015-10-10-bibao/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/11/15/2015-10-10-bibao/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>正确的说,应该是指一个闭包域,每当声明了一个函数,它就产生了一个闭包域(可以解释为每个函数都有自己的函数栈),每个闭包域(Function 对象)都有一个 function scope(不是属性),function scope内默认有个名为 Globe 的全局引用(有了这个引用,就可以直接调用 Globe 的属性或方法)<br>凡是在闭包域内声明的变量或方法,外部无法直接访问<br>闭包域可以访问外部的变量或方法<br>图片描述<br>(上图为 chrome 下 debug 环境)</p>
<p>当在一个闭包域内包含另一个闭包域时(简单的说就是在一个函数内有另一个函数,当然这个内部函数的生命周期是依附于外部函数的), 此时,若子闭包域(内部的闭包域,内部函数)使用了父闭包域(外部闭包域,外部函数)的私有变量(在父闭包域中声明的变量,父闭包域的外部空间无法直接访问,但子闭包域可以访问),子闭包域即当前的子函数的 function scope 会产生一个 closure 对象属性,这个对象属性内包含的是子闭包域对父闭包域的所有引用(只要子闭包域(内部函数)还存活,其父闭包域(外部函数)就依旧存活),倘若在父闭包域存活期间对其私有变量内容进行修改,则对这些父闭包域的私有变量进行引用的子闭包域中 function scope 的 closure 对象属性的内容也会发生变化,因为这只是引用.</p>
<p>举例:</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;script type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;
        //函数 a 有一个私有变量 p 和一个内部函数 innerA
        function a() {                      //外部闭包域 ,一个名为 a 的 Function 对象
            var p = 0;                      //私有变量 p
            var innerA = function () {      //内部闭包域 ,一个名为 innerA 的 Function 对象
                console.log(p);             //对外部闭包域的私有变量进行了引用,故 innerA 对象的 function scope 会产生一个名为 closure 的对象属性,closure 对象内含有一个名为 p 的引用
            }

            innerA();//输出0
            p++;
            innerA();//输出1
        }
        a();
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><p>结果如下:</p>
<p>第一次调用innerA<br>图片描述</p>
<p>第二次调用 innerA<br>图片描述</p>
<p>控制台输出<br>图片描述</p>
<p>回到主题 面试经典问题</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;&lt;/title&gt;
    &lt;script type=&quot;text/javascript&quot;&gt;
        //面试经典问题:

        function onMyLoad(){
            /*
            抛出问题:
                此题的目的是想每次点击对应目标时弹出对应的数字下标 0~4,但实际是无论点击哪个目标都会弹出数字5
            问题所在:
                arr 中的每一项的 onclick 均为一个函数实例(Function 对象),这个函数实例也产生了一个闭包域,
                这个闭包域引用了外部闭包域的变量,其 function scope 的 closure 对象有个名为 i 的引用,
                外部闭包域的私有变量内容发生变化,内部闭包域得到的值自然会发生改变
            */
            var arr = document.getElementsByTagName(&quot;p&quot;);
            for(var i = 0; i &lt; arr.length;i++){
                arr[i].onclick = function(){
                    alert(i);
                }
            }
        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body onload=&quot;onMyLoad()&quot;&gt;
    &lt;p&gt;产品一&lt;/p&gt;
    &lt;p&gt;产品二&lt;/p&gt;
    &lt;p&gt;产品三&lt;/p&gt;
    &lt;p&gt;产品四&lt;/p&gt;
    &lt;p&gt;产品五&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><p>解决办法:</p>
<p>解决办法一</p>
<pre><code>/*
解决思路:
    增加若干个对应的闭包域空间(这里采用的是匿名函数),专门用来存储原先需要引用的内容(下标),不过只限于基本类型(基本类型值传递,对象类型引用传递)
 */
for(var i = 0;i&lt;arr.length;i++){

    //声明一个匿名函数,若传进来的是基本类型则为值传递,故不会对实参产生影响,
    //该函数对象有一个本地私有变量arg(形参) ,该函数的 function scope 的 closure 对象属性有两个引用,一个是 arr,一个是 i
    //尽管引用 i 的值随外部改变 ,但本地私有变量(形参) arg 不会受影响,其值在一开始被调用的时候就决定了.
    (function (arg) {
        arr[i].onclick = function () {  //onclick函数实例的 function scope 的 closure 对象属性有一个引用 arg,
            alert(arg);                 //只要 外部空间的 arg 不变,这里的引用值当然不会改变
        }
    })(i);                              //立刻执行该匿名函数,传递下标 i(实参)
}
</code></pre><p>解决办法二</p>
<pre><code>/*
解决思路:
    将下标作为对象属性(name:&quot;i&quot;,value:i的值)添加到每个数组项(p对象)中
*/
for(var i = 0;i&lt;arr.length;i++){
    //为当前数组项即当前 p 对象添加一个名为 i 的属性,值为循环体的 i 变量的值,
    //此时当前 p 对象的 i 属性并不是对循环体的 i 变量的引用,而是一个独立p 对象的属性,属性值在声明的时候就确定了
    //(基本类型的值都是存在栈中的,当有一个基本类型变量声明其等于另一个基本变量时,此时并不是两个基本类型变量都指向一个值,而是各自有各自的值,但值是相等的)
    arr[i].i = i;
    arr[i].onclick = function () {
        alert(this.i);
    }
}
</code></pre><p>解决办法三</p>
<pre><code>/*
解决思路:
    与解决办法一有点相似但却有点不太相似.
    相似点:同样是增加若干个对应的闭包域空间用来存储下标
    不同点:解决办法一是在新增的匿名闭包空间内完成事件的绑定,而此例是将事件绑定在新增的匿名函数返回的函数上

    此时绑定的函数中的 function scope 中的 closure 对象的 引用 arg 是指向将其返回的匿名函数的私有变量 arg
 */
for(var i = 0; i&lt;arr.length;i++){
    arr[i].onclick = (function(arg){
        return function () {
            alert(arg);
        }
    })(i);
}
</code></pre><p>解决办法四</p>
<pre><code>/*
解决思路与解决办法一相同
 */
for(var i = 0; i&lt;arr.length;i++){
    (function(){
       var temp = i;
        arr[i].onclick = function () {
            alert(temp);
        }
    })();
}
</code></pre><p>解决办法五</p>
<pre><code>/*
解决思路与解决办法三及四相同
 */
for(var i = 0;i&lt;arr.length;i++){
    arr[i].onclick = (function () {
        var temp = i;
        return function () {
            alert(temp);
        }
    })();
}
</code></pre><p>解决办法六</p>
<pre><code>/*
解决思路:
    将下标添加为绑定函数的属性
 */
for(var i = 0;i&lt;arr.length;i++){
    (arr[i].onclick = function () {
        alert(arguments.callee.i);      //arguments 参数对象  arguments.callee 参数对象所属函数
    }).i = i;
}
</code></pre><p>解决办法七</p>
<pre><code>/*
解决思路:
    通过 new 使用 Function 的构造函数 创建 Function 实例实现,由于传入的函数体的内容是字符串,故 Function 得到的是一个字符串拷贝,而没有得到 i 的引用(这里是先获取 i.toString()然后与前后字符串拼接成一个新的字符串,Function 对其进行反向解析成 JS 代码)
 */
for(var i = 0;i&lt;arr.length;i++){
    arr[i].onclick = new Function(&quot;alert(&quot;+i+&quot;);&quot;);//每 new 一个 Function 得到一个 Function 对象(一个函数),有自己的闭包域
}
</code></pre><p>解决办法八</p>
<pre><code>/*
解决思路:
    直接通过 Function 返回一个函数
    与解决办法七的不同之处在于:
        解决办法七使用 new,使用了 new,此时 Function 函数就被当成构造器可以用来构造一个 Function 实例返回
        当前解决办法没有使用 new ,即将 Function 函数当成一个函数,传入参数返回一个新函数;
        其实此处 new 与不 new 只是的区别在于:
            使用了 new 即 Function 函数充当构造器,由 JS 解析器生产一个新的对象,构造器内的 this 指向该新对象;
            不实用 new 即 Function 函数依旧是函数,由函数内部自己生产一个实例返回.
 */
for(var i = 0;i&lt;arr.length;i++){
    arr[i].onclick = Function(&quot;alert(&quot;+i+&quot;);&quot;);
}
</code></pre><p>解决办法大同小异,只要理解其中的实质,可以写出多多的解决办法</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://flyingliu.github.io/2015/11/15/2015-10-10-web-page/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="飞来小侠">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="如是我闻">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/11/15/2015-10-10-web-page/" itemprop="url">提高网页显示性能</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-11-15T16:37:02+08:00">
                2015-11-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/11/15/2015-10-10-web-page/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/11/15/2015-10-10-web-page/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>你遇到过性能很差的网页吗？这种网页响应非常缓慢，占用大量的CPU和内存，浏览起来常常有卡顿，页面的动画效果也不流畅。</p>
<p>你会有什么反应？我猜想，大多数用户会关闭这个页面，改为访问其他网站。作为一个开发者，肯定不愿意看到这种情况，那么怎样才能提高性能呢？</p>
<h1 id="一、网页生成的过程"><a href="#一、网页生成的过程" class="headerlink" title="一、网页生成的过程"></a>一、网页生成的过程</h1><p>要理解网页性能为什么不好，就要了解网页是怎么生成的。</p>
<p>网页的生成过程，大致可以分成五步。</p>
<ol>
<li>HTML代码转化成DOM</li>
<li>CSS代码转化成CSSOM（CSS Object Model）</li>
<li>结合DOM和CSSOM，生成一棵渲染树（包含每个节点的视觉信息）</li>
<li>生成布局（layout），即将所有渲染树的所有节点进行平面合成</li>
<li>将布局绘制（paint）在屏幕上</li>
</ol>
<p>这五步里面，第一步到第三步都非常快，耗时的是第四步和第五步。</p>
<p><strong>“生成布局”（flow）和”绘制”（paint）这两步，合称为”渲染”（render）。</strong></p>
<h1 id="二、重排和重绘"><a href="#二、重排和重绘" class="headerlink" title="二、重排和重绘"></a>二、重排和重绘</h1><p>网页生成的时候，至少会渲染一次。用户访问的过程中，还会不断重新渲染。</p>
<p>以下三种情况，会导致网页重新渲染。</p>
<ul>
<li>修改DOM</li>
<li>修改样式表</li>
<li>用户事件（比如鼠标悬停、页面滚动、输入框键入文字、改变窗口大小等等）</li>
</ul>
<p>重新渲染，就需要重新生成布局和重新绘制。前者叫做”重排”（reflow），后者叫做”重绘”（repaint）。</p>
<p>需要注意的是，<strong>“重绘”不一定需要”重排”</strong>，比如改变某个网页元素的颜色，就只会触发”重绘”，不会触发”重排”，因为布局没有改变。但是，<strong>“重排”必然导致”重绘”</strong>，比如改变一个网页元素的位置，就会同时触发”重排”和”重绘”，因为布局改变了。</p>
<p>三、对于性能的影响</p>
<p>重排和重绘会不断触发，这是不可避免的。但是，它们非常耗费资源，是导致网页性能低下的根本原因。</p>
<p>提高网页性能，就是要降低”重排”和”重绘”的频率和成本，尽量少触发重新渲染。</p>
<p>前面提到，DOM变动和样式变动，都会触发重新渲染。但是，浏览器已经很智能了，会尽量把所有的变动集中在一起，排成一个队列，然后一次性执行，尽量避免多次重新渲染。</p>
<pre><code>div.style.color = &apos;blue&apos;;
div.style.marginTop = &apos;30px&apos;;
</code></pre><p>上面代码中，div元素有两个样式变动，但是浏览器只会触发一次重排和重绘。</p>
<p>如果写得不好，就会触发两次重排和重绘。</p>
<pre><code>div.style.color = &apos;blue&apos;;
var margin = parseInt(div.style.marginTop);
div.style.marginTop = (margin + 10) + &apos;px&apos;;
</code></pre><p>上面代码对div元素设置背景色以后，第二行要求浏览器给出该元素的位置，所以浏览器不得不立即重排。</p>
<p>一般来说，样式的写操作之后，如果有下面这些属性的读操作，都会引发浏览器立即重新渲染。</p>
<pre><code>offsetTop/offsetLeft/offsetWidth/offsetHeight
scrollTop/scrollLeft/scrollWidth/scrollHeight
clientTop/clientLeft/clientWidth/clientHeight
getComputedStyle()
</code></pre><p>所以，从性能角度考虑，尽量不要把读操作和写操作，放在一个语句里面。</p>
<pre><code>// bad
div.style.left = div.offsetLeft + 10 + &quot;px&quot;;
div.style.top = div.offsetTop + 10 + &quot;px&quot;;

// good
var left = div.offsetLeft;
var top  = div.offsetTop;
div.style.left = left + 10 + &quot;px&quot;;
div.style.top = top + 10 + &quot;px&quot;;
</code></pre><p>一般的规则是：</p>
<ul>
<li>样式表越简单，重排和重绘就越快。</li>
<li>重排和重绘的DOM元素层级越高，成本就越高。</li>
<li>table元素的重排和重绘成本，要高于div元素</li>
</ul>
<h1 id="四、提高性能的九个技巧"><a href="#四、提高性能的九个技巧" class="headerlink" title="四、提高性能的九个技巧"></a>四、提高性能的九个技巧</h1><p>有一些技巧，可以降低浏览器重新渲染的频率和成本。</p>
<p>第一条是上一节说到的，DOM 的多个读操作（或多个写操作），应该放在一起。不要两个读操作之间，加入一个写操作。</p>
<p>第二条，如果某个样式是通过重排得到的，那么最好缓存结果。避免下一次用到的时候，浏览器又要重排。</p>
<p>第三条，不要一条条地改变样式，而要通过改变class，或者csstext属性，一次性地改变样式。</p>
<pre><code>// bad
var left = 10;
var top = 10;
el.style.left = left + &quot;px&quot;;
el.style.top  = top  + &quot;px&quot;;

// good
el.className += &quot; theclassname&quot;;

// good
el.style.cssText += &quot;; left: &quot; + left + &quot;px; top: &quot; + top + &quot;px;&quot;;
</code></pre><p>第四条，尽量使用离线DOM，而不是真实的网面DOM，来改变元素样式。比如，操作Document Fragment对象，完成后再把这个对象加入DOM。再比如，使用 cloneNode() 方法，在克隆的节点上进行操作，然后再用克隆的节点替换原始节点。</p>
<p>第五条，先将元素设为display: none（需要1次重排和重绘），然后对这个节点进行100次操作，最后再恢复显示（需要1次重排和重绘）。这样一来，你就用两次重新渲染，取代了可能高达100次的重新渲染。</p>
<p>第六条，position属性为absolute或fixed的元素，重排的开销会比较小，因为不用考虑它对其他元素的影响。</p>
<p>第七条，只在必要的时候，才将元素的display属性为可见，因为不可见的元素不影响重排和重绘。另外，visibility : hidden的元素只对重绘有影响，不影响重排。</p>
<p>第八条，使用虚拟DOM的脚本库，比如React等。</p>
<p>第九条，使用 window.requestAnimationFrame()、window.requestIdleCallback() 这两个方法调节重新渲染（详见后文）。</p>
<h1 id="五、刷新率"><a href="#五、刷新率" class="headerlink" title="五、刷新率"></a>五、刷新率</h1><p>很多时候，密集的重新渲染是无法避免的，比如scroll事件的回调函数和网页动画。</p>
<p>网页动画的每一帧（frame）都是一次重新渲染。每秒低于24帧的动画，人眼就能感受到停顿。一般的网页动画，需要达到每秒30帧到60帧的频率，才能比较流畅。如果能达到每秒70帧甚至80帧，就会极其流畅。</p>
<p>大多数显示器的刷新频率是60Hz，为了与系统一致，以及节省电力，浏览器会自动按照这个频率，刷新动画（如果可以做到的话）。</p>
<p>所以，如果网页动画能够做到每秒60帧，就会跟显示器同步刷新，达到最佳的视觉效果。这意味着，一秒之内进行60次重新渲染，每次重新渲染的时间不能超过16.66毫秒。</p>
<p>一秒之间能够完成多少次重新渲染，这个指标就被称为”刷新率”，英文为FPS（frame per second）。60次重新渲染，就是60FPS。</p>
<h1 id="六、开发者工具的Timeline面板"><a href="#六、开发者工具的Timeline面板" class="headerlink" title="六、开发者工具的Timeline面板"></a>六、开发者工具的Timeline面板</h1><p>Chrome浏览器开发者工具的Timeline面板，是查看”刷新率”的最佳工具。这一节介绍如何使用这个工具。</p>
<p>首先，按下 F12 打开”开发者工具”，切换到Timeline面板。</p>
<p>左上角有一个灰色的圆点，这是录制按钮，按下它会变成红色。然后，在网页上进行一些操作，再按一次按钮完成录制。</p>
<p>Timeline面板提供两种查看方式：横条的是”事件模式”（Event Mode），显示重新渲染的各种事件所耗费的时间；竖条的是”帧模式”（Frame Mode），显示每一帧的时间耗费在哪里。</p>
<p>先看”事件模式”，你可以从中判断，性能问题发生在哪个环节，是JavaScript的执行，还是渲染？</p>
<p>不同的颜色表示不同的事件。</p>
<p>蓝色：网络通信和HTML解析<br>黄色：JavaScript执行<br>紫色：样式计算和布局，即重排<br>绿色：重绘</p>
<p>哪种色块比较多，就说明性能耗费在那里。色块越长，问题越大。</p>
<p>帧模式（Frames mode）用来查看单个帧的耗时情况。每帧的色柱高度越低越好，表示耗时少。</p>
<p>你可以看到，帧模式有两条水平的参考线。</p>
<p>下面的一条是60FPS，低于这条线，可以达到每秒60帧；上面的一条是30FPS，低于这条线，可以达到每秒30次渲染。如果色柱都超过30FPS，这个网页就有性能问题了。<br>此外，还可以查看某个区间的耗时情况。</p>
<p>或者点击每一帧，查看该帧的时间构成。</p>
<h1 id="七、window-requestAnimationFrame"><a href="#七、window-requestAnimationFrame" class="headerlink" title="七、window.requestAnimationFrame()"></a>七、window.requestAnimationFrame()</h1><p>有一些JavaScript方法可以调节重新渲染，大幅提高网页性能。</p>
<p>其中最重要的，就是 window.requestAnimationFrame() 方法。它可以将某些代码放到下一次重新渲染时执行。</p>
<pre><code>function doubleHeight(element) {
  var currentHeight = element.clientHeight;
  element.style.height = (currentHeight * 2) + &apos;px&apos;;
}
elements.forEach(doubleHeight);
</code></pre><p>上面的代码使用循环操作，将每个元素的高度都增加一倍。可是，每次循环都是，读操作后面跟着一个写操作。这会在短时间内触发大量的重新渲染，显然对于网页性能很不利。</p>
<p>我们可以使用window.requestAnimationFrame()，让读操作和写操作分离，把所有的写操作放到下一次重新渲染。</p>
<pre><code>function doubleHeight(element) {
  var currentHeight = element.clientHeight;
  window.requestAnimationFrame(function () {
    element.style.height = (currentHeight * 2) + &apos;px&apos;;
  });
}
elements.forEach(doubleHeight);
</code></pre><p>页面滚动事件（scroll）的监听函数，就很适合用 window.requestAnimationFrame() ，推迟到下一次重新渲染。</p>
<pre><code>$(window).on(&apos;scroll&apos;, function() {
   window.requestAnimationFrame(scrollHandler);
});
</code></pre><p>当然，最适用的场合还是网页动画。下面是一个旋转动画的例子，元素每一帧旋转1度。</p>
<pre><code>var rAF = window.requestAnimationFrame;

var degrees = 0;
function update() {
  div.style.transform = &quot;rotate(&quot; + degrees + &quot;deg)&quot;;
  console.log(&apos;updated to degrees &apos; + degrees);
  degrees = degrees + 1;
  rAF(update);
}
rAF(update);
</code></pre><h1 id="八、window-requestIdleCallback"><a href="#八、window-requestIdleCallback" class="headerlink" title="八、window.requestIdleCallback()"></a>八、window.requestIdleCallback()</h1><p>还有一个函数window.requestIdleCallback()，也可以用来调节重新渲染。</p>
<p>它指定只有当一帧的末尾有空闲时间，才会执行回调函数。</p>
<pre><code>requestIdleCallback(fn);
</code></pre><p>上面代码中，只有当前帧的运行时间小于16.66ms时，函数fn才会执行。否则，就推迟到下一帧，如果下一帧也没有空闲时间，就推迟到下下一帧，以此类推。</p>
<p>它还可以接受第二个参数，表示指定的毫秒数。如果在指定 的这段时间之内，每一帧都没有空闲时间，那么函数fn将会强制执行。</p>
<pre><code>requestIdleCallback(fn, 5000);
</code></pre><p>上面的代码表示，函数fn最迟会在5000毫秒之后执行。</p>
<p>函数 fn 可以接受一个 deadline 对象作为参数。</p>
<pre><code>requestIdleCallback(function someHeavyComputation(deadline) {
  while(deadline.timeRemaining() &gt; 0) {
    doWorkIfNeeded();
  }

  if(thereIsMoreWorkToDo) {
    requestIdleCallback(someHeavyComputation);
  }
});
</code></pre><p>上面代码中，回调函数 someHeavyComputation 的参数是一个 deadline 对象。</p>
<p>deadline对象有一个方法和一个属性：timeRemaining() 和 didTimeout。</p>
<p>（1）timeRemaining() 方法</p>
<p>timeRemaining() 方法返回当前帧还剩余的毫秒。这个方法只能读，不能写，而且会动态更新。因此可以不断检查这个属性，如果还有剩余时间的话，就不断执行某些任务。一旦这个属性等于0，就把任务分配到下一轮requestIdleCallback。</p>
<p>前面的示例代码之中，只要当前帧还有空闲时间，就不断调用doWorkIfNeeded方法。一旦没有空闲时间，但是任务还没有全执行，就分配到下一轮requestIdleCallback。</p>
<p>（2）didTimeout属性</p>
<p>deadline对象的 didTimeout 属性会返回一个布尔值，表示指定的时间是否过期。这意味着，如果回调函数由于指定时间过期而触发，那么你会得到两个结果。</p>
<p>timeRemaining方法返回0</p>
<p>didTimeout 属性等于 true</p>
<p>因此，如果回调函数执行了，无非是两种原因：当前帧有空闲时间，或者指定时间到了。</p>
<pre><code>function myNonEssentialWork (deadline) {
  while ((deadline.timeRemaining() &gt; 0 || deadline.didTimeout) &amp;&amp; tasks.length &gt; 0)
    doWorkIfNeeded();

  if (tasks.length &gt; 0)
    requestIdleCallback(myNonEssentialWork);
}

requestIdleCallback(myNonEssentialWork, 5000);
</code></pre><p>上面代码确保了，doWorkIfNeeded 函数一定会在将来某个比较空闲的时间（或者在指定时间过期后）得到反复执行。</p>
<p>requestIdleCallback 是一个很新的函数，刚刚引入标准，目前只有Chrome支持。</p>
<h1 id="九、参考链接"><a href="#九、参考链接" class="headerlink" title="九、参考链接"></a>九、参考链接</h1><ul>
<li>Domenico De Felice, <a href="http://domenicodefelice.blogspot.sg/2015/08/how-browsers-work.html" target="_blank" rel="external">How browsers work</a></li>
<li>Stoyan Stefanov, <a href="http://www.phpied.com/rendering-repaint-reflowrelayout-restyle/" target="_blank" rel="external">Rendering: repaint, reflow/relayout, restyle</a></li>
<li>Addy Osmani, <a href="http://addyosmani.com/blog/performance-optimisation-with-timeline-profiles/" target="_blank" rel="external">Improving Web App Performance With the Chrome DevTools Timeline and Profiles</a></li>
<li>Tom Wiltzius, <a href="http://www.html5rocks.com/en/tutorials/speed/rendering/" target="_blank" rel="external">Jank Busting for Better Rendering Performance</a></li>
<li>Paul Lewis, <a href="https://developers.google.com/web/updates/2015/08/27/using-requestidlecallback?hl=en" target="_blank" rel="external">Using requestIdleCallback</a></li>
<li>本文原文链接：<a href="http://www.ruanyifeng.com/blog/2015/09/web-page-performance-in-depth.html" target="_blank" rel="external">http://www.ruanyifeng.com/blog/2015/09/web-page-performance-in-depth.html</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://flyingliu.github.io/2015/11/15/2015-10-13-string-to-boolean/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="飞来小侠">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="如是我闻">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/11/15/2015-10-13-string-to-boolean/" itemprop="url">JS中字符串转布尔值</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-11-15T16:37:02+08:00">
                2015-11-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/11/15/2015-10-13-string-to-boolean/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/11/15/2015-10-13-string-to-boolean/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>问题：ajax返回的值是字符串“true”和“false”，怎么转成相应的布尔值<code>true</code>和<code>false</code><br><a href="http://stackoverflow.com/questions/263965/how-can-i-convert-a-string-to-boolean-in-javascript" target="_blank" rel="external">stackoverflow</a>网站上提出过这个问题</p>
<pre><code>var myBool = Boolean(&quot;false&quot;);  // == true
var myBool = !!&quot;false&quot;;  // == true
</code></pre><p>如果值是字符串“true”和“false”，那么无论怎么强制转换成布尔值，都是布尔值true。有人提出用JSON方法来转，很不错。</p>
<pre><code>JSON.parse(&quot;true&quot;); // == true
JSON.parse(&quot;false&quot;);// == false
</code></pre><p>当然这个值只限于能转成js基本类型的值。</p>
<pre><code>JSON.parse(str); str为一个标准格式的 JSON 字符串，并返回解析后的 JavaScript 对象。
JSON.parse(&apos;False&apos;);  // Uncaught SyntaxError:
JSON.parse(&apos;False&apos;.toLowerCase());  // false,如果不确定大小写可以先转一下;
!!JSON.parse(&apos;null&apos;) //false
</code></pre><p>用jQuery或者zepto,可以用：</p>
<pre><code>$.parseJSON(str);
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://flyingliu.github.io/2015/11/15/2015-10-13-css/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="飞来小侠">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="如是我闻">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/11/15/2015-10-13-css/" itemprop="url">12 个 CSS 高级技巧汇总</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-11-15T16:37:02+08:00">
                2015-11-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/11/15/2015-10-13-css/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/11/15/2015-10-13-css/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>下面这些CSS高级技巧，一般人我可不告诉他哦。</p>
<ul>
<li>使用 :not() 在菜单上应用/取消应用边框</li>
<li>给body添加行高</li>
<li>所有一切都垂直居中</li>
<li>逗号分隔的列表</li>
<li>使用负的 nth-child 选择项目</li>
<li>对图标使用SVG</li>
<li>优化显示文本</li>
<li>对纯CSS滑块使用 max-height</li>
<li>继承 box-sizing</li>
<li>表格单元格等宽</li>
<li>用Flexbox摆脱外边距的各种hack</li>
<li>使用属性选择器用于空链接</li>
<li>使用 :not() 在菜单上应用/取消应用边框</li>
</ul>
<p>先给每一个菜单项添加边框</p>
<pre><code>/* add border */
.nav li {
  border-right: 1px solid #666;
}
</code></pre><p>……然后再除去最后一个元素……</p>
<pre><code>//* remove border */

.nav li:last-child {
  border-right: none;
}
</code></pre><p>……可以直接使用 :not() 伪类来应用元素：</p>
<pre><code>.nav li:not(:last-child) {
  b
  order-right: 1px solid #666;
}
</code></pre><p>这样代码就干净，易读，易于理解了。</p>
<p>当然，如果你的新元素有兄弟元素的话，也可以使用通用的兄弟选择符（~）：</p>
<pre><code>nav li:first-child ~ li {

  border-left: 1px solid #666;
}
</code></pre><h1 id="给-body添加行高"><a href="#给-body添加行高" class="headerlink" title="给 body添加行高"></a>给 body添加行高</h1><p>你不需要分别添加 line-height 到每个 <code>&lt;p&gt;</code>，<code>&lt;h*&gt;</code>等。只要添加到 body 即可：</p>
<pre><code>body {
  line-height: 1;
}
</code></pre><p>这样文本元素就可以很容易地从 body 继承。</p>
<h1 id="所有一切都垂直居中"><a href="#所有一切都垂直居中" class="headerlink" title="所有一切都垂直居中"></a>所有一切都垂直居中</h1><p>要将所有元素垂直居中，太简单了：</p>
<pre><code>html, body {
  height: 100%;
  margin: 0;
}

body {
  -webkit-align-items: center;
  -ms-flex-align: center;
  align-items: center;
  display: -webkit-flex;
  display: flex;
}
</code></pre><p>看，是不是很简单。</p>
<p>注：在IE11中要小心flexbox。</p>
<h1 id="逗号分隔的列表"><a href="#逗号分隔的列表" class="headerlink" title="逗号分隔的列表"></a>逗号分隔的列表</h1><p>让HTML列表项看上去像一个真正的，用逗号分隔的列表：</p>
<pre><code>ul &gt; li:not(:last-child)::after {
  content: &quot;,&quot;;
}
</code></pre><p>对最后一个列表项使用 :not() 伪类。</p>
<p>使用负的 nth-child 选择项目</p>
<p>在CSS中使用负的 nth-child 选择项目1到项目n。</p>
<pre><code>li {
  display: none;
}

/* select items 1 through 3 and display them */
li:nth-child(-n+3) {
  display: block;
}
</code></pre><p>就是这么容易。</p>
<h1 id="对图标使用SVG"><a href="#对图标使用SVG" class="headerlink" title="对图标使用SVG"></a>对图标使用SVG</h1><p>我们没有理由不对图标使用SVG：</p>
<pre><code>.logo {
  background: url(&quot;logo.svg&quot;);
}
</code></pre><p>SVG对所有的分辨率类型都具有良好的扩展性，并支持所有浏览器都回归到IE9。这样可以避开.png、.jpg或.gif文件了。</p>
<h1 id="优化显示文本"><a href="#优化显示文本" class="headerlink" title="优化显示文本"></a>优化显示文本</h1><p>有时，字体并不能在所有设备上都达到最佳的显示，所以可以让设备浏览器来帮助你：</p>
<pre><code>html {
  -moz-osx-font-smoothing: grayscale;
  -webkit-font-smoothing: antialiased;
  text-rendering: optimizeLegibility;
}
</code></pre><p>注：请负责任地使用 optimizeLegibility。此外，IE /Edge没有 text-rendering 支持。</p>
<h1 id="对纯CSS滑块使用-max-height"><a href="#对纯CSS滑块使用-max-height" class="headerlink" title="对纯CSS滑块使用 max-height"></a>对纯CSS滑块使用 max-height</h1><p>使用 max-height 和溢出隐藏来实现只有CSS的滑块：</p>
<pre><code>.slider ul {
  max-height: 0;
  overlow: hidden;
}

.slider:hover ul {
  max-height: 1000px;
  transition: .3s ease;
}
</code></pre><h1 id="继承-box-sizing"><a href="#继承-box-sizing" class="headerlink" title="继承 box-sizing"></a>继承 box-sizing</h1><p>让 box-sizing 继承 html：</p>
<pre><code>html {
  box-sizing: border-box;
}

*, *:before, *:after {
  box
  -sizing: inherit;
}
</code></pre><p>这样在插件或杠杆其他行为的其他组件中就能更容易地改变 box-sizing 了。</p>
<h1 id="表格单元格等宽"><a href="#表格单元格等宽" class="headerlink" title="表格单元格等宽"></a>表格单元格等宽</h1><p>表格工作起来很麻烦，所以务必尽量使用 table-layout: fixed 来保持单元格的等宽：</p>
<pre><code>.calendar {
  table-layout: fixed;
}
</code></pre><h1 id="用Flexbox摆脱外边距的各种hack"><a href="#用Flexbox摆脱外边距的各种hack" class="headerlink" title="用Flexbox摆脱外边距的各种hack"></a>用Flexbox摆脱外边距的各种hack</h1><p>当需要用到列分隔符时，通过flexbox的 space-between 属性，你就可以摆脱nth-，first-，和 last-child 的hack了：</p>
<pre><code>.list {
  display: flex;
  justify-content: space-between;
}

.list .person {
  flex-basis: 23%;
}
</code></pre><p>现在，列表分隔符就会在均匀间隔的位置出现。</p>
<h1 id="使用属性选择器用于空链接"><a href="#使用属性选择器用于空链接" class="headerlink" title="使用属性选择器用于空链接"></a>使用属性选择器用于空链接</h1><p>当 a 元素没有文本值，但 href 属性有链接的时候显示链接：</p>
<pre><code>a[href^=&quot;http&quot;]:empty::before {
  content: attr(href);
}
</code></pre><p>相当方便。</p>
<p>支持</p>
<p>这些高级技巧在Chrome、Firefox、Safari、Edge的当前版本，以及IE11中都能有效工作。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://flyingliu.github.io/2015/11/15/2015-10-20-duanlu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="飞来小侠">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="如是我闻">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/11/15/2015-10-20-duanlu/" itemprop="url">对js运算符“||”和“&&”的总结</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-11-15T16:37:02+08:00">
                2015-11-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/11/15/2015-10-20-duanlu/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/11/15/2015-10-20-duanlu/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>首先出个题：</p>
<p>假设对成长速度显示规定如下：<br>成长速度为5显示1个箭头；<br>成长速度为10显示2个箭头；<br>成长速度为12显示3个箭头；<br>成长速度为15显示4个箭头；<br>其他都显示都显示0各箭头。<br>用代码怎么实现？</p>
<p>差一点的if，else：</p>
<pre><code>var add_level = 0;
if(add_step == 5){
    add_level = 1;
}
else if(add_step == 10){
    add_level = 2;
}
else if(add_step == 12){
    add_level = 3;
}
else if(add_step == 15){
    add_level = 4;
}
else {
    add_level = 0;
}
</code></pre><p>稍好些的switch：</p>
<pre><code>var add_level = 0;

switch(add_step){
    case 5 : add_level = 1;
        break;
    case 10 : add_level = 2;
        break;
    case 12 : add_level = 3;
        break;
    case 15 : add_level = 4;
        break;
    default : add_level = 0;
        break;
}
</code></pre><p>如果需求改成：<br>成长速度为&gt;12显示4个箭头；<br>成长速度为&gt;10显示3个箭头；<br>成长速度为&gt;5显示2个箭头；<br>成长速度为&gt;0显示1个箭头；<br>成长速度为&lt;=0显示0个箭头。</p>
<p>那么用switch实现起来也很麻烦了。</p>
<p>那么你有没有想过用一行就代码实现呢？<br>ok，让我们来看看js强大的表现力吧：</p>
<pre><code>var add_level = (add_step==5 &amp;&amp; 1) || (add_step==10 &amp;&amp; 2) || (add_step==12 &amp;&amp; 3) || (add_step==15 &amp;&amp; 4) || 0;
</code></pre><p>更强大的，也更优的：</p>
<pre><code>var add_level={&apos;5&apos;:1,&apos;10&apos;:2,&apos;12&apos;:3,&apos;15&apos;:4}[add_step] || 0;
</code></pre><p>第二个需求：</p>
<pre><code>var add_level = (add_step&gt;12 &amp;&amp; 4) || (add_step&gt;10 &amp;&amp; 3) || (add_step&gt;5 &amp;&amp; 2) || (add_step&gt;0 &amp;&amp; 1) || 0;
</code></pre><p>首先我们来梳理一下一个概念，请你一定要记住：在js逻辑运算中，0、””、null、false、undefined、NaN都会判为false，其他都为true（好像没有遗漏了吧，请各位确认下）。这个一定要记住，不然应用<code>||</code>和&amp;&amp;就会出现问题。</p>
<p>这里顺便提下：经常有人问我，看到很多代码if(!!attr)，为什么不直接写if(attr)；</p>
<p>其实这是一种更严谨的写法：<br>请测试 typeof 5和typeof !!5的区别。!!的作用是把一个其他类型的变量转成的bool类型。</p>
<p>下面主要讨论下逻辑运算符&amp;&amp;和<code>||</code>。</p>
<p>几乎所有语言中<code>||</code>和&amp;&amp;都遵循“短路”原理，如&amp;&amp;中第一个表达式为假就不会去处理第二个表达式，而<code>||</code>正好相反。<br>js也遵循上述原则。但是比较有意思的是它们返回的值。</p>
<p>代码：var attr = true &amp;&amp; 4 &amp;&amp; “aaa”;</p>
<p>那么运行的结果attr就不是简单的true或这false，而是”aaa”</p>
<p>再来看看<code>||</code>：</p>
<p>代码：var attr = attr <code>||</code> “”;这个运算经常用来判断一个变量是否已定义，如果没有定义就给他一个初始值，这在给函数的参数定义一个默认值的时候比较有用。因为js不像php可以直接在型参数上定义func($attr=5)。再次提醒你记住上面的原则：如果实参需要是0、””、null、false、undefined、NaN的时候也会当false来处理。</p>
<pre><code>if(a &gt;=5){
    alert(&quot;你好&quot;);
}
// 可以写成：
a &gt;= 5 &amp;&amp; alert(&quot;你好&quot;);
</code></pre><p>这样只需一行代码就搞定。但是需要注意的一点就是：js中<code>||</code>和&amp;&amp;的特性帮我们精简了代码的同时，也带来了代码可读性的降低。这就需要我们自己来权衡了。</p>
<p>一方面精简js代码，能实质性的减少网络流量，尤其是大量应用的js公用库。个人比较推荐的做法是：如果是相对复杂的应用，请适当地写一些注释。这个和正在表达式一样，能够精简代码，但是可读性会降低，对读代码的人要求会高些，最好的办法就是写注释。</p>
<p>我们可以不使用这些技巧，但是我们一定要能看懂，因为这些技巧已经广泛应用，尤其是像JQuery等js框里的代码，不理解这些你就很难看懂别人的代码。<br>像var Yahoo = Yahoo <code>||</code> {};这种是非常广泛应用的。</p>
<p>ok,最后让我们来看一段jQuery中的代码吧：</p>
<pre><code>var wrap =
// option or optgroup
!tags.indexOf(&quot;&lt;opt&quot;) &amp;&amp;
[ 1, &quot;&lt;select multiple=&apos;multiple&apos;&gt;&quot;, &quot;&lt;/select&gt;&quot; ] ||

!tags.indexOf(&quot;&lt;leg&quot;) &amp;&amp;
[ 1, &quot;&lt;fieldset&gt;&quot;, &quot;&lt;/fieldset&gt;&quot; ] ||

tags.match(/^&lt;(thead|tbody|tfoot|colg|cap)/) &amp;&amp;
[ 1, &quot;&lt;table&gt;&quot;, &quot;&lt;/table&gt;&quot; ] ||

!tags.indexOf(&quot;&lt;tr&quot;) &amp;&amp;
[ 2, &quot;&lt;table&gt;&lt;tbody&gt;&quot;, &quot;&lt;/tbody&gt;&lt;/table&gt;&quot; ] ||

// &lt;thead&gt; matched above
(!tags.indexOf(&quot;&lt;td&quot;) || !tags.indexOf(&quot;&lt;th&quot;)) &amp;&amp;
[ 3, &quot;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&quot;, &quot;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&quot; ] ||

!tags.indexOf(&quot;&lt;col&quot;) &amp;&amp;
[ 2, &quot;&lt;table&gt;&lt;tbody&gt;&lt;/tbody&gt;&lt;colgroup&gt;&quot;, &quot;&lt;/colgroup&gt;&lt;/table&gt;&quot; ] ||

// IE can&apos;t serialize &lt;link&gt; and &lt;script&gt; tags normally
!jQuery.support.htmlSerialize &amp;&amp;
[ 1, &quot;div&lt;div&gt;&quot;, &quot;&lt;/div&gt;&quot; ] ||

[ 0, &quot;&quot;, &quot;&quot; ];

// Go to html and back, then peel off extra wrappers
div.innerHTML = wrap[1] + elem + wrap[2];

// Move to the right depth
while ( wrap[0]-- )
    div = div.lastChild;
</code></pre><p>这段代码是作者用来处理 <code>$(html)</code>时，有些标签必须要约束的，如<code>&lt;option&gt;</code>必须在<code>&lt;select&gt;&lt;/select&gt;</code>之内的。</p>
<p>可能你也发现了作者还有一个很巧的地方就是 <code>!tags.indexOf(&quot;&lt;opt&quot;)</code>，作者很巧很简单的就实现了startWith的功能了，没有一点多余的代码。jquery源代码中还有很多如此精妙的代码，大家可以去学习学习。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://flyingliu.github.io/2015/10/04/2015-10-02-line/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="飞来小侠">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="如是我闻">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/10/04/2015-10-02-line/" itemprop="url">线条与临摹</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-10-04T21:14:31+08:00">
                2015-10-04
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/10/04/2015-10-02-line/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/10/04/2015-10-02-line/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>以前我看过一个关于书法的定义：是一种线条的艺术。当时很不以为然，书法包括的东西应该远不止于线条：章法，笔法，结构，墨法。然而越往后越觉得有道到了，书法就是一种线条的艺术。</p>
<p>线条是有重量的。我最欣赏近代陆维钊先生的隶书线条，线条中间或出现的飞白展现厚重。而像怀素的草书（特指自序帖）线条，更多的是展现一种韧性，话说“折钗股”者当如此。</p>
<p>线条是有气质的。</p>
<p>线条是有性情的。</p>
<p>我以前一直不知道临帖的重要性，且常以不临帖为傲。后来发现其实是自己错了，我不是不临帖，只是临摹的对象杂且层次不高。我记得我小学时当时自己的一笔钱就是买了一本硬币字帖，是丁永康先生的。当然买了也没怎么去临摹，而是常翻翻。当时家里条件不好，买本字帖是很奢侈的，而乡里书店里的书少得可怜，关于字帖方面的是唯一一本。所以现在回过头来看，少时也是对书法很感兴趣的，只是没有名师指导，自己靠着点悟性，比别人字写得正一点。也正是由于这一点悟性，让自己一直抱有对书法的热忱。我可能在写字教科书看到一个帖，不经意间去揣摩。</p>
<p>以上以我各人的一点有限的经历主要想说明以下几点：</p>
<p>一. 临帖是重要的，也是必要的。一些书法爱好者自诩没领过帖字也写得还行的，其实是不存在的。倒是可以说临摹多家而不精。</p>
<p>二. 以读帖方式的临摹其实也是有效果的，多背帖，多总结其实也是很重要的。</p>
<p>三. 在学习初期最好有人指导，或者看看视频教程。最好是生活中有临摹经验或者取得一定成绩的书法家指导。</p>
<p>前段时间看到一个有趣的问题：书法家都必须经过一个临摹法帖的阶段，无临摹是无法成为书法家的。这里有个悖论是第一个书法家临摹谁的？在他之前是没有书法家的，也没有法帖的，那他怎么成为书法家的呢?我觉得可以从这么几个方面来回答这个问题。</p>
<p>一. 我们不排除上天的安排，有些人天生就是书法家。在中国这么长久的历史中，我们数得着的书法家可以说都是天才。上天给予他们异常的天赋。</p>
<p>二. 像书圣王羲之也是依靠他的勤奋，池水尽墨，还有名师指点，还有综合他那个时代的审美趣味，才能引领书法潮流。</p>
<p>三. 有的人是能够从自然中获得灵感的，他的帖就是自然界的千变万化。这还是需要天才才能发现的。比如描述线条的有“折钗股”、“屋漏痕”。</p>
<p>四. 站在巨人的肩膀上总是容易获得成功的，在当下有如此多的法帖供选择，有如此多的资料可以供参阅，为什么要舍近求远呢？</p>
<p>临摹是追赶古人的一种有效手段，我们的临摹还不单单是从临摹中获得技法，更重要的是在临摹中了解线性，更好的掌控心手，从起落行笔间激发发现美的敏感程度。</p>
<p>是的，我们取法法帖并不以写得像为唯一宗旨。写得像是一个很初级的阶段，也是一个入门的阶段。怎么起笔、怎么行笔、怎么收笔、行笔速度都是要在这一阶段解决的。这里我想提一个书法艺术的直觉性。在我们的教科书中总是死死的规定逆锋起笔、中锋行笔，非如此不正确。我认为这是一个很大的谬误。作为书写者个体的想象力直接给剥夺了。这么一些死死的条规无比有好。</p>
<p>我记得在一次书法交流活动中，看到一位同学写魏碑，当时给我很大的震撼。当时的我还不理解魏碑，看不懂魏碑。那位同学的书写过程相当繁杂，比如在一个外放内圆的转折会特意将毛笔绕圈以求能写出那种笔画。写出来结果是达到了，很像。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://flyingliu.github.io/2015/10/02/javascript/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="飞来小侠">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="如是我闻">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/10/02/javascript/" itemprop="url">Hello World</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-10-02T13:54:37+08:00">
                2015-10-02
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/10/02/javascript/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/10/02/javascript/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dicta, impedit!</p>
<p>这是劳动法师德师风大师傅额。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> a = [<span class="string">'once'</span>, <span class="string">'a'</span>, <span class="string">'rebound,'</span>, <span class="string">'always'</span>, <span class="string">'a'</span>, <span class="string">'rebound.'</span>]</div><div class="line"><span class="keyword">var</span> msg = <span class="string">''</span></div><div class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = a.length</div><div class="line">    i &lt; len</div><div class="line">    i++) &#123;</div><div class="line">    msg += a[i] + <span class="string">' '</span></div><div class="line">&#125;</div><div class="line"><span class="built_in">console</span>.log(msg)</div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://flyingliu.github.io/2015/10/01/2015-09-26-test/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="飞来小侠">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="如是我闻">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/10/01/2015-09-26-test/" itemprop="url">this is a test</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-10-01T00:24:48+08:00">
                2015-10-01
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/10/01/2015-09-26-test/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/10/01/2015-09-26-test/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Hugo发布时要注意的地方</p>
<p>生产环境和开发环境的区别，server命令不加参数baseUrl时输出的链接全是localhost:1313的绝对地址，所以push前需要删除public文件夹，然后hugo -t themeName就行了；如果配置文件制定了theme,那么直觉 hugo 命令就行了。</p>
<ol>
<li><p>front-matter内容中url的值最好符合Jekyll的格式，这与config.toml中的permalinks相关联，详细设置在 <a href="http://gohugo.io/content/organization/" target="_blank" rel="external">http://gohugo.io/content/organization/</a></p>
</li>
<li><p>post的md文件编码必须是utf-8的，要不乱码</p>
</li>
<li><p>分享个cmd文件hugo-n用于快速新建一篇博文()</p>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="飞来小侠" />
          <p class="site-author-name" itemprop="name">飞来小侠</p>
           
              <p class="site-description motion-element" itemprop="description">依法不依人，依义不依语。</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">58</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">19</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/flyingliu" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/u/5872146656" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                    
                      Weibo
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.douban.com/people/guolaiwan/" target="_blank" title="豆瓣">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                    
                      豆瓣
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/liu-fei-lai/activities" target="_blank" title="知乎">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                    
                      知乎
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">飞来小侠</span>

  
</div>


  <div class="powered-by">
    由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
  </div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">
    主题 &mdash;
    <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
      NexT.Pisces
    </a>
  </div>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script>



  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  

    
      <script id="dsq-count-scr" src="https://ananfo.disqus.com/count.js" async></script>
    

    

  




	





  










  





  

  

  

  

  

  

</body>
</html>
